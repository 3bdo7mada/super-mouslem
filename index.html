<!doctype html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8">
<title>Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body{
  margin:0;
  font-family:Tajawal,sans-serif;
  background:linear-gradient(135deg,#020617,#0f172a);
  color:#fff;
  display:flex;
  justify-content:center;
  align-items:center;
  min-height:100vh;
}
.container{
  width:100%;
  max-width:950px;
  background:#020617;
  padding:24px;
  border-radius:20px;
  box-shadow:0 25px 50px rgba(0,0,0,.7);
  position:relative;
}
.top-inputs{display:flex; gap:10px; margin-bottom:12px;}
.top-inputs input{flex:1; padding:10px; border-radius:10px; border:none;}
.identity{text-align:center; margin-bottom:15px; font-weight:700; color:#38bdf8;}
.export-btn{width:100%; margin-bottom:12px; padding:12px; font-weight:700; color:#38bdf8; border-radius:14px; border:1px solid rgba(56,189,248,.5); background:rgba(255,255,255,0.05); backdrop-filter:blur(10px); cursor:pointer; transition:0.3s;}
.export-btn:hover{background:rgba(56,189,248,0.1);}
table{width:100%; border-collapse:collapse; border-radius:14px; overflow:hidden;}
th,td{padding:12px; text-align:center; border-left:1px solid #1e293b;}
th:first-child, td:first-child{border-left:none;}
th{color:#38bdf8;}
td{border-bottom:none;}
.day-separator td{border-top:2px solid #1e293b; border-bottom:2px solid #1e293b; color:#94a3b8; font-weight:700; text-align:right;}
tr.today{background:linear-gradient(180deg,rgba(56,189,248,.08),rgba(56,189,248,.02)); outline:1.5px solid rgba(56,189,248,.45); outline-offset:-3px;}
tr.done{background:linear-gradient(180deg,rgba(34,197,94,.08),rgba(34,197,94,.02)); outline:1.5px solid rgba(34,197,94,.45);}
tr.today.done{outline-color:rgba(34,197,94,.6);}
tr.locked{opacity:.45; filter:blur(.4px);}
.locked-label{font-size:13px; color:#facc15;}
.admin-panel{margin-top:15px; display:none; flex-direction:column; gap:10px;}
.admin-panel input,.admin-panel select{padding:10px; border-radius:10px; border:none;}
.admin-btn{margin-top:20px; width:100%; background:#334155; color:#fff; padding:10px; border-radius:12px; border:none; cursor:pointer;}
.admin-btn-small{
  padding:6px 10px;
  margin:0 2px;
  font-size:13px;
  font-weight:700;
  color:#38bdf8;
  border-radius:10px;
  border:1px solid rgba(56,189,248,.5);
  background:rgba(255,255,255,0.05);
  backdrop-filter:blur(6px);
  cursor:pointer;
  transition:0.3s;
}
.admin-btn-small:hover{
  background:rgba(56,189,248,.1);
}
.admin-only{display:none;}

/* Footer Ø­Ù‚ÙˆÙ‚ Ø§Ù„Ù…Ø·ÙˆØ± */
.developer-footer{
  position:absolute;
  bottom:-12px;
  left:50%;
  transform:translateX(-50%);
  padding:6px 14px;
  border-radius:20px;
  color:#ff4d4d;
  font-size:12px;
  font-weight:700;
  text-align:center;
  text-shadow:0 0 8px rgba(255,0,0,0.4);
  backdrop-filter:blur(8px);
  background:rgba(0,0,0,0.2);
  border:2px solid rgba(255,0,0,0.4);
}

/* Progress Bar */
.progress-container{
  width:100%;
  height:14px;
  background:#334155;
  border-radius:10px;
  margin-bottom:12px;
  overflow:hidden;
}
.progress-bar{
  height:100%;
  width:0%;
  background:linear-gradient(90deg,#38bdf8,#22c55e);
  transition:width 0.3s;
}
</style>
</head>

<body>

<div class="container">
  <div class="top-inputs" id="inputsBox">
    <input id="userName" placeholder="Ø§Ø³Ù…Ùƒ Ø§Ù„ÙƒØ§Ù…Ù„">
    <input id="groupName" placeholder="Ø±Ù‚Ù… Ø§Ù„Ø¬Ø±ÙˆØ¨">
  </div>
  <div class="identity" id="identityText"></div>

  <div class="progress-container"><div class="progress-bar" id="progressBar"></div></div>

  <button class="export-btn" onclick="exportPDF()">ğŸ“„ ØªØµØ¯ÙŠØ± ÙƒÙ…Ù„Ù PDF</button>

  <table>
    <thead>
      <tr>
        <th>Ø§Ù„ÙŠÙˆÙ…</th>
        <th>Ø§Ù„Ù…Ù‡Ù…Ø©</th>
        <th>Ø§Ù„Ø­Ø§Ù„Ø©</th>
        <th class="admin-only">Ø¥Ø¬Ø±Ø§Ø¡Ø§Øª</th>
      </tr>
    </thead>
    <tbody id="tasksBody"></tbody>
  </table>

  <div class="admin-panel" id="adminPanel">
    <select id="taskDay">
      <option>Ø§Ù„Ø£Ø­Ø¯</option><option>Ø§Ù„Ø§Ø«Ù†ÙŠÙ†</option><option>Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡</option>
      <option>Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡</option><option>Ø§Ù„Ø®Ù…ÙŠØ³</option><option>Ø§Ù„Ø¬Ù…Ø¹Ø©</option><option>Ø§Ù„Ø³Ø¨Øª</option>
    </select>
    <input id="taskText" placeholder="Ù…Ù‡Ù…Ø© Ø¬Ø¯ÙŠØ¯Ø©">
    <div style="display:flex; gap:10px;">
      <button onclick="addTask()">Ø¥Ø¶Ø§ÙØ©</button>
      <button onclick="exitAdmin()">ğŸ’¾ Ø­ÙØ¸ ÙˆØ±Ø¬ÙˆØ¹</button>
    </div>
  </div>

  <button class="admin-btn" id="adminBtn">ğŸ›  ØªØ³Ø¬ÙŠÙ„ Ø§Ù„Ø¯Ø®ÙˆÙ„ ÙƒÙ…Ø³Ø¤ÙˆÙ„</button>

  <div class="developer-footer">developed by ABDO_HMADA Â© 2025</div>
</div>

<audio id="successSound" src="https://assets.mixkit.co/active_storage/sfx/2018/2018-preview.mp3"></audio>

<script>
// Firebase config
const firebaseConfig = {
  apiKey: "AIzaSyC-YGNx2l_aGSB-LewMKF-8Gv3fhGhClMY",
  authDomain: "weekly-taskes.firebaseapp.com",
  projectId: "weekly-taskes",
  storageBucket: "weekly-taskes.firebasestorage.app",
  messagingSenderId: "1000288332388",
  appId: "1:1000288332388:web:c80094bea1730d78a88d71",
  measurementId: "G-2CLT049QYR"
};
firebase.initializeApp(firebaseConfig);
const db = firebase.firestore();

const ADMIN_PASSWORD="super_mouslem_549@_+#";
const days=["Ø§Ù„Ø£Ø­Ø¯","Ø§Ù„Ø§Ø«Ù†ÙŠÙ†","Ø§Ù„Ø«Ù„Ø§Ø«Ø§Ø¡","Ø§Ù„Ø£Ø±Ø¨Ø¹Ø§Ø¡","Ø§Ù„Ø®Ù…ÙŠØ³","Ø§Ù„Ø¬Ù…Ø¹Ø©","Ø§Ù„Ø³Ø¨Øª"];
const todayIndex=new Date().getDay();
const tasksBody=document.getElementById("tasksBody");
const adminPanel=document.getElementById("adminPanel");
const successSound=document.getElementById("successSound");
const progressBar=document.getElementById("progressBar");

/* Ø§Ù„Ù‡ÙˆÙŠØ© */
const nameSaved=localStorage.getItem("userName");
const groupSaved=localStorage.getItem("groupName");
if(nameSaved && groupSaved){
  inputsBox.style.display="none";
  identityText.textContent=`${nameSaved} â€” Ø¬Ø±ÙˆØ¨ ${groupSaved}`;
}
[userName,groupName].forEach(i=>{
  i?.addEventListener("change",()=>{
    if(userName.value && groupName.value){
      localStorage.setItem("userName",userName.value);
      localStorage.setItem("groupName",groupName.value);
      location.reload();
    }
  });
});

/* Ø§Ù„Ø£Ø¯Ù…Ù† */
let isAdmin=false;
adminBtn.onclick=()=>{
  const pass=prompt("ÙƒÙ„Ù…Ø© Ø³Ø± Ø§Ù„Ù…Ø³Ø¤ÙˆÙ„");
  if(pass===ADMIN_PASSWORD){
    isAdmin=true;
    adminPanel.style.display="flex";
    adminBtn.style.display="none";
    document.querySelectorAll(".admin-only").forEach(e=>e.style.display="table-cell");
    renderTasks();
  }
};

/* Firestore Ø§Ù„ØªØ¹Ø§Ù…Ù„ Ù…Ø¹ Ø§Ù„Ù…Ù‡Ø§Ù… */
async function getTasks(){ 
  const snapshot = await db.collection("weeklyTasks").orderBy("day").get();
  return snapshot.docs.map(d=>({id:d.id,...d.data()}));
}
async function saveTask(task){
  if(task.id){
    await db.collection("weeklyTasks").doc(task.id).update(task);
  }else{
    await db.collection("weeklyTasks").add(task);
  }
}
async function deleteTask(taskId){
  await db.collection("weeklyTasks").doc(taskId).delete();
}
async function toggleDone(task){
  task.done = !task.done;
  await saveTask(task);
  if(task.done) { successSound.currentTime=0; successSound.play(); }
  renderTasks();
}

/* Render */
async function renderTasks(){
  const tasks = await getTasks();
  tasksBody.innerHTML="";
  
  const doneCount = tasks.filter(t=>t.done).length;
  const percent = tasks.length? Math.round((doneCount/tasks.length)*100):0;
  progressBar.style.width=percent+"%";
  
  days.forEach((day,dayIndex)=>{
    const dayTasks=tasks.filter(t=>t.day===day);
    if(!dayTasks.length) return;
    tasksBody.innerHTML+=`<tr class="day-separator"><td colspan="4">ğŸ“Œ ${day}</td></tr>`;
    dayTasks.forEach(t=>{
      const locked = dayIndex>todayIndex && !isAdmin;
      const actions = isAdmin? 
        `<button class="admin-btn-small" onclick="editTask('${t.id}')">âœ ØªØ¹Ø¯ÙŠÙ„</button>
         <button class="admin-btn-small" onclick="deleteTask('${t.id}')">ğŸ—‘ Ø­Ø°Ù</button>`:'';
      tasksBody.innerHTML+=`
      <tr class="${locked?'locked':''} ${t.done?'done':''} ${dayIndex===todayIndex?'today':''}">
        <td>${t.day}</td>
        <td>${t.text}</td>
        <td>${locked?'<span class="locked-label">ğŸ”’ Ù…Ù‚ÙÙˆÙ„Ø©</span>':'<input type="checkbox" '+(t.done?'checked':'')+' onchange="toggleDoneHandler('${t.id}')">'}</td>
        <td>${actions}</td>
      </tr>`;
    });
  });
}

/* Handlers */
async function toggleDoneHandler(taskId){
  const tasks = await getTasks();
  const task = tasks.find(t=>t.id===taskId);
  if(task) toggleDone(task);
}
async function editTask(taskId){
  const tasks = await getTasks();
  const task = tasks.find(t=>t.id===taskId);
  if(!task) return;
  const newText = prompt("Ø¹Ø¯Ù„ Ù†Øµ Ø§Ù„Ù…Ù‡Ù…Ø©:", task.text);
  if(newText && newText.trim()!==''){
    task.text = newText.trim();
    await saveTask(task);
    renderTasks();
  }
}
async function addTask(){
  if(!taskText.value) return;
  await saveTask({day:taskDay.value,text:taskText.value,done:false});
  taskText.value="";
  renderTasks();
}

/* PDF */
function exportPDF(){
  const {jsPDF}=window.jspdf;
  const pdf=new jsPDF();
  let y=15;
  pdf.setFontSize(16);
  pdf.text("Ø¬Ø¯ÙˆÙ„ Ø§Ù„Ù…Ù‡Ø§Ù… Ø§Ù„Ø£Ø³Ø¨ÙˆØ¹ÙŠØ©",105,y,{align:"center"});
  y+=10;
  getTasks().then(tasks=>{
    tasks.forEach(t=>{
      pdf.setFontSize(12);
      pdf.text(`- ${t.day} | ${t.text} | ${t.done?"ØªÙ…Øª":"Ù„Ù… ØªØªÙ…"}`,10,y);
      y+=8;
    });
    pdf.save("weekly_tasks.pdf");
  });
}

renderTasks();
</script>
</body>
</html>